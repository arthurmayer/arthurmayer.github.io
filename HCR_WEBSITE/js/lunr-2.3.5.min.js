/*
 MIT
 lunr.utils
 Copyright (C) 2018 Oliver Nightingale
 lunr.Set
 Copyright (C) 2018 Oliver Nightingale
 lunr.tokenizer
 Copyright (C) 2018 Oliver Nightingale
 lunr.Pipeline
 Copyright (C) 2018 Oliver Nightingale
 lunr.Vector
 Copyright (C) 2018 Oliver Nightingale
 lunr.stemmer
 Copyright (C) 2018 Oliver Nightingale
 Includes code from - http://tartarus.org/~martin/PorterStemmer/js.txt
 lunr.stopWordFilter
 Copyright (C) 2018 Oliver Nightingale
 lunr.trimmer
 Copyright (C) 2018 Oliver Nightingale
 lunr.TokenSet
 Copyright (C) 2018 Oliver Nightingale
 lunr.Index
 Copyright (C) 2018 Oliver Nightingale
 lunr.Builder
 Copyright (C) 2018 Oliver Nightingale
*/
(function(){var b=function(a){var c=new b.Builder;c.pipeline.add(b.trimmer,b.stopWordFilter,b.stemmer);c.searchPipeline.add(b.stemmer);a.call(c,c);return c.build()};b.version="2.3.5";b.utils={};b.utils.warn=function(a){return function(b){a.console&&console.warn&&console.warn(b)}}(this);b.utils.asString=function(a){return void 0===a||null===a?"":a.toString()};b.utils.clone=function(a){if(null===a||void 0===a)return a;for(var b=Object.create(null),d=Object.keys(a),g=0;g<d.length;g++){var e=d[g],f=a[e];
if(Array.isArray(f))b[e]=f.slice();else if("string"===typeof f||"number"===typeof f||"boolean"===typeof f)b[e]=f;else throw new TypeError("clone is not deep and does not support nested objects");}return b};b.FieldRef=function(a,b,d){this.docRef=a;this.fieldName=b;this._stringValue=d};b.FieldRef.joiner="/";b.FieldRef.fromString=function(a){var c=a.indexOf(b.FieldRef.joiner);if(-1===c)throw"malformed field ref string";var d=a.slice(0,c);c=a.slice(c+1);return new b.FieldRef(c,d,a)};b.FieldRef.prototype.toString=
function(){void 0==this._stringValue&&(this._stringValue=this.fieldName+b.FieldRef.joiner+this.docRef);return this._stringValue};b.Set=function(a){this.elements=Object.create(null);if(a){this.length=a.length;for(var b=0;b<this.length;b++)this.elements[a[b]]=!0}else this.length=0};b.Set.complete={intersect:function(a){return a},union:function(a){return a},contains:function(){return!0}};b.Set.empty={intersect:function(){return this},union:function(a){return a},contains:function(){return!1}};b.Set.prototype.contains=
function(a){return!!this.elements[a]};b.Set.prototype.intersect=function(a){var c=[];if(a===b.Set.complete)return this;if(a===b.Set.empty)return a;if(this.length<a.length)var d=this;else d=a,a=this;d=Object.keys(d.elements);for(var g=0;g<d.length;g++){var e=d[g];e in a.elements&&c.push(e)}return new b.Set(c)};b.Set.prototype.union=function(a){return a===b.Set.complete?b.Set.complete:a===b.Set.empty?this:new b.Set(Object.keys(this.elements).concat(Object.keys(a.elements)))};b.idf=function(a,b){var c=
0,g;for(g in a)"_index"!=g&&(c+=Object.keys(a[g]).length);return Math.log(1+Math.abs((b-c+.5)/(c+.5)))};b.Token=function(a,b){this.str=a||"";this.metadata=b||{}};b.Token.prototype.toString=function(){return this.str};b.Token.prototype.update=function(a){this.str=a(this.str,this.metadata);return this};b.Token.prototype.clone=function(a){a=a||function(a){return a};return new b.Token(a(this.str,this.metadata),this.metadata)};b.tokenizer=function(a,c){if(null==a||void 0==a)return[];if(Array.isArray(a))return a.map(function(a){return new b.Token(b.utils.asString(a).toLowerCase(),
b.utils.clone(c))});for(var d=a.toString().trim().toLowerCase(),g=d.length,e=[],f=0,h=0;f<=g;f++){var k=d.charAt(f),l=f-h;if(k.match(b.tokenizer.separator)||f==g)0<l&&(k=b.utils.clone(c)||{},k.position=[h,l],k.index=e.length,e.push(new b.Token(d.slice(h,f),k))),h=f+1}return e};b.tokenizer.separator=/[\s\-]+/;b.Pipeline=function(){this._stack=[]};b.Pipeline.registeredFunctions=Object.create(null);b.Pipeline.registerFunction=function(a,c){c in this.registeredFunctions&&b.utils.warn("Overwriting existing registered function: "+
c);a.label=c;b.Pipeline.registeredFunctions[a.label]=a};b.Pipeline.warnIfFunctionNotRegistered=function(a){a.label&&a.label in this.registeredFunctions||b.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",a)};b.Pipeline.load=function(a){var c=new b.Pipeline;a.forEach(function(a){var d=b.Pipeline.registeredFunctions[a];if(d)c.add(d);else throw Error("Cannot load unregistered function: "+a);});return c};b.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(a){b.Pipeline.warnIfFunctionNotRegistered(a);
this._stack.push(a)},this)};b.Pipeline.prototype.after=function(a,c){b.Pipeline.warnIfFunctionNotRegistered(c);var d=this._stack.indexOf(a);if(-1==d)throw Error("Cannot find existingFn");this._stack.splice(d+1,0,c)};b.Pipeline.prototype.before=function(a,c){b.Pipeline.warnIfFunctionNotRegistered(c);var d=this._stack.indexOf(a);if(-1==d)throw Error("Cannot find existingFn");this._stack.splice(d,0,c)};b.Pipeline.prototype.remove=function(a){a=this._stack.indexOf(a);-1!=a&&this._stack.splice(a,1)};b.Pipeline.prototype.run=
function(a){for(var b=this._stack.length,d=0;d<b;d++){for(var g=this._stack[d],e=[],f=0;f<a.length;f++){var h=g(a[f],f,a);if(void 0!==h&&""!==h)if(Array.isArray(h))for(var k=0;k<h.length;k++)e.push(h[k]);else e.push(h)}a=e}return a};b.Pipeline.prototype.runString=function(a,c){var d=new b.Token(a,c);return this.run([d]).map(function(a){return a.toString()})};b.Pipeline.prototype.reset=function(){this._stack=[]};b.Pipeline.prototype.toJSON=function(){return this._stack.map(function(a){b.Pipeline.warnIfFunctionNotRegistered(a);
return a.label})};b.Vector=function(a){this._magnitude=0;this.elements=a||[]};b.Vector.prototype.positionForIndex=function(a){if(0==this.elements.length)return 0;for(var b=0,d=this.elements.length/2,g=d-b,e=Math.floor(g/2),f=this.elements[2*e];1<g;){f<a&&(b=e);f>a&&(d=e);if(f==a)break;g=d-b;e=b+Math.floor(g/2);f=this.elements[2*e]}if(f==a||f>a)return 2*e;if(f<a)return 2*(e+1)};b.Vector.prototype.insert=function(a,b){this.upsert(a,b,function(){throw"duplicate index";})};b.Vector.prototype.upsert=function(a,
b,d){this._magnitude=0;var c=this.positionForIndex(a);this.elements[c]==a?this.elements[c+1]=d(this.elements[c+1],b):this.elements.splice(c,0,a,b)};b.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var a=0,b=this.elements.length,d=1;d<b;d+=2){var g=this.elements[d];a+=g*g}return this._magnitude=Math.sqrt(a)};b.Vector.prototype.dot=function(a){var b=0,d=this.elements;a=a.elements;for(var g=d.length,e=a.length,f,h,k=0,l=0;k<g&&l<e;)f=d[k],h=a[l],f<h?k+=2:f>h?l+=2:
f==h&&(b+=d[k+1]*a[l+1],k+=2,l+=2);return b};b.Vector.prototype.similarity=function(a){return this.dot(a)/this.magnitude()||0};b.Vector.prototype.toArray=function(){for(var a=Array(this.elements.length/2),b=1,d=0;b<this.elements.length;b+=2,d++)a[d]=this.elements[b];return a};b.Vector.prototype.toJSON=function(){return this.elements};b.stemmer=function(){var a={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",
ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},b={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},d=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,g=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/,e=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$/,f=/^([^aeiou][^aeiouy]*)?[aeiouy]/,h=/^(.+?)(ss|i)es$/,k=/^(.+?)([^s])s$/,l=/^(.+?)eed$/,
m=/^(.+?)(ed|ing)$/,r=/.$/,u=/(at|bl|iz)$/,x=/([^aeiouylsz])\1$/,v=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,p=/^(.+?[^aeiou])y$/,w=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,z=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,C=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,B=/^(.+?)(s|t)(ion)$/,F=/^(.+?)e$/,D=/ll$/,G=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/,E=function(c){if(3>
c.length)return c;var y=c.substr(0,1);"y"==y&&(c=y.toUpperCase()+c.substr(1));var q=h;var n=k;q.test(c)?c=c.replace(q,"$1$2"):n.test(c)&&(c=c.replace(n,"$1$2"));q=l;n=m;if(q.test(c))n=q.exec(c),q=d,q.test(n[1])&&(q=r,c=c.replace(q,""));else if(n.test(c)){n=n.exec(c);var t=n[1];n=f;if(n.test(t)){c=t;n=u;var A=x;n.test(c)?c+="e":A.test(c)?(q=r,c=c.replace(q,"")):v.test(c)&&(c+="e")}}q=p;q.test(c)&&(n=q.exec(c),t=n[1],c=t+"i");q=w;q.test(c)&&(n=q.exec(c),t=n[1],n=n[2],q=d,q.test(t)&&(c=t+a[n]));q=z;
q.test(c)&&(n=q.exec(c),t=n[1],n=n[2],q=d,q.test(t)&&(c=t+b[n]));q=C;n=B;q.test(c)?(n=q.exec(c),t=n[1],q=g,q.test(t)&&(c=t)):n.test(c)&&(n=n.exec(c),t=n[1]+n[2],n=g,n.test(t)&&(c=t));q=F;q.test(c)&&(n=q.exec(c),t=n[1],q=g,n=e,A=G,q.test(t)||n.test(t)&&!A.test(t))&&(c=t);q=D;n=g;q.test(c)&&n.test(c)&&(q=r,c=c.replace(q,""));"y"==y&&(c=y.toLowerCase()+c.substr(1));return c};return function(a){return a.update(E)}}();b.Pipeline.registerFunction(b.stemmer,"stemmer");b.generateStopWordFilter=function(a){var b=
a.reduce(function(a,b){a[b]=b;return a},{});return function(a){if(a&&b[a.toString()]!==a.toString())return a}};b.stopWordFilter=b.generateStopWordFilter("a able about across after all almost also am among an and any are as at be because been but by can cannot could dear did do does either else ever every for from get got had has have he her hers him his how however i if in into is it its just least let like likely may me might most must my neither no nor not of off often on only or other our own rather said say says she should since so some than that the their them then there these they this tis to too twas us wants was we were what when where which while who whom why will with would yet you your".split(" "));
b.Pipeline.registerFunction(b.stopWordFilter,"stopWordFilter");b.trimmer=function(a){return a.update(function(a){return a.replace(/^\W+/,"").replace(/\W+$/,"")})};b.Pipeline.registerFunction(b.trimmer,"trimmer");b.TokenSet=function(){this["final"]=!1;this.edges={};this.id=b.TokenSet._nextId;b.TokenSet._nextId+=1};b.TokenSet._nextId=1;b.TokenSet.fromArray=function(a){for(var c=new b.TokenSet.Builder,d=0,g=a.length;d<g;d++)c.insert(a[d]);c.finish();return c.root};b.TokenSet.fromClause=function(a){return"editDistance"in
a?b.TokenSet.fromFuzzyString(a.term,a.editDistance):b.TokenSet.fromString(a.term)};b.TokenSet.fromFuzzyString=function(a,c){for(var d=new b.TokenSet,g=[{node:d,editsRemaining:c,str:a}];g.length;){var e=g.pop();if(0<e.str.length){var f=e.str.charAt(0);if(f in e.node.edges)var h=e.node.edges[f];else h=new b.TokenSet,e.node.edges[f]=h;1==e.str.length&&(h["final"]=!0);g.push({node:h,editsRemaining:e.editsRemaining,str:e.str.slice(1)})}0<e.editsRemaining&&1<e.str.length&&(f=e.str.charAt(1),f in e.node.edges?
h=e.node.edges[f]:(h=new b.TokenSet,e.node.edges[f]=h),2>=e.str.length?h["final"]=!0:g.push({node:h,editsRemaining:e.editsRemaining-1,str:e.str.slice(2)}));0<e.editsRemaining&&1==e.str.length&&(e.node["final"]=!0);0<e.editsRemaining&&1<=e.str.length&&("*"in e.node.edges?f=e.node.edges["*"]:(f=new b.TokenSet,e.node.edges["*"]=f),1==e.str.length?f["final"]=!0:g.push({node:f,editsRemaining:e.editsRemaining-1,str:e.str.slice(1)}));0<e.editsRemaining&&("*"in e.node.edges?f=e.node.edges["*"]:(f=new b.TokenSet,
e.node.edges["*"]=f),0==e.str.length?f["final"]=!0:g.push({node:f,editsRemaining:e.editsRemaining-1,str:e.str}));if(0<e.editsRemaining&&1<e.str.length){f=e.str.charAt(0);h=e.str.charAt(1);if(h in e.node.edges)var k=e.node.edges[h];else k=new b.TokenSet,e.node.edges[h]=k;1==e.str.length?k["final"]=!0:g.push({node:k,editsRemaining:e.editsRemaining-1,str:f+e.str.slice(2)})}}return d};b.TokenSet.fromString=function(a){for(var c=new b.TokenSet,d=c,g=0,e=a.length;g<e;g++){var f=a[g],h=g==e-1;if("*"==f)c.edges[f]=
c,c["final"]=h;else{var k=new b.TokenSet;k["final"]=h;c=c.edges[f]=k}}return d};b.TokenSet.prototype.toArray=function(){for(var a=[],b=[{prefix:"",node:this}];b.length;){var d=b.pop(),g=Object.keys(d.node.edges),e=g.length;d.node["final"]&&(d.prefix.charAt(0),a.push(d.prefix));for(var f=0;f<e;f++){var h=g[f];b.push({prefix:d.prefix.concat(h),node:d.node.edges[h]})}}return a};b.TokenSet.prototype.toString=function(){if(this._str)return this._str;for(var a=this["final"]?"1":"0",b=Object.keys(this.edges).sort(),
d=b.length,g=0;g<d;g++){var e=b[g];a=a+e+this.edges[e].id}return a};b.TokenSet.prototype.intersect=function(a){for(var c=new b.TokenSet,d=[{qNode:a,output:c,node:this}];d.length;){a=d.pop();for(var g=Object.keys(a.qNode.edges),e=g.length,f=Object.keys(a.node.edges),h=f.length,k=0;k<e;k++)for(var l=g[k],m=0;m<h;m++){var r=f[m];if(r==l||"*"==l){var u=a.node.edges[r],x=a.qNode.edges[l],v=u["final"]&&x["final"];if(r in a.output.edges){var p=a.output.edges[r];p["final"]=p["final"]||v}else p=new b.TokenSet,
p["final"]=v,a.output.edges[r]=p;d.push({qNode:x,output:p,node:u})}}}return c};b.TokenSet.Builder=function(){this.previousWord="";this.root=new b.TokenSet;this.uncheckedNodes=[];this.minimizedNodes={}};b.TokenSet.Builder.prototype.insert=function(a){var c=0;if(a<this.previousWord)throw Error("Out of order word insertion");for(var d=0;d<a.length&&d<this.previousWord.length&&a[d]==this.previousWord[d];d++)c++;this.minimize(c);var g=0==this.uncheckedNodes.length?this.root:this.uncheckedNodes[this.uncheckedNodes.length-
1].child;for(d=c;d<a.length;d++){c=new b.TokenSet;var e=a[d];g.edges[e]=c;this.uncheckedNodes.push({parent:g,"char":e,child:c});g=c}g["final"]=!0;this.previousWord=a};b.TokenSet.Builder.prototype.finish=function(){this.minimize(0)};b.TokenSet.Builder.prototype.minimize=function(a){for(var b=this.uncheckedNodes.length-1;b>=a;b--){var d=this.uncheckedNodes[b],g=d.child.toString();g in this.minimizedNodes?d.parent.edges[d["char"]]=this.minimizedNodes[g]:(d.child._str=g,this.minimizedNodes[g]=d.child);
this.uncheckedNodes.pop()}};b.Index=function(a){this.invertedIndex=a.invertedIndex;this.fieldVectors=a.fieldVectors;this.tokenSet=a.tokenSet;this.fields=a.fields;this.pipeline=a.pipeline};b.Index.prototype.search=function(a){return this.query(function(c){(new b.QueryParser(a,c)).parse()})};b.Index.prototype.query=function(a){for(var c=new b.Query(this.fields),d=Object.create(null),g=Object.create(null),e=Object.create(null),f=Object.create(null),h=Object.create(null),k=0;k<this.fields.length;k++)g[this.fields[k]]=
new b.Vector;a.call(c,c);for(k=0;k<c.clauses.length;k++){var l=c.clauses[k],m=null,r=b.Set.complete;m=l.usePipeline?this.pipeline.runString(l.term,{fields:l.fields}):[l.term];for(var u=0;u<m.length;u++){l.term=m[u];a=b.TokenSet.fromClause(l);var x=this.tokenSet.intersect(a).toArray();if(0===x.length&&l.presence===b.Query.presence.REQUIRED){for(var v=0;v<l.fields.length;v++){var p=l.fields[v];f[p]=b.Set.empty}break}for(var w=0;w<x.length;w++){var z=x[w],C=this.invertedIndex[z],B=C._index;for(v=0;v<
l.fields.length;v++){p=l.fields[v];var F=C[p],D=Object.keys(F),G=z+"/"+p;a=new b.Set(D);l.presence==b.Query.presence.REQUIRED&&(r=r.union(a),void 0===f[p]&&(f[p]=b.Set.complete));if(l.presence==b.Query.presence.PROHIBITED)void 0===h[p]&&(h[p]=b.Set.empty),h[p]=h[p].union(a);else if(g[p].upsert(B,l.boost,function(a,b){return a+b}),!e[G]){for(var E=0;E<D.length;E++){var A=D[E];a=new b.FieldRef(A,p);A=F[A];var y;void 0===(y=d[a])?d[a]=new b.MatchData(z,p,A):y.add(z,p,A)}e[G]=!0}}}}if(l.presence===b.Query.presence.REQUIRED)for(v=
0;v<l.fields.length;v++)p=l.fields[v],f[p]=f[p].intersect(r)}e=b.Set.complete;y=b.Set.empty;for(k=0;k<this.fields.length;k++)p=this.fields[k],f[p]&&(e=e.intersect(f[p])),h[p]&&(y=y.union(h[p]));f=Object.keys(d);h=[];p=Object.create(null);if(c.isNegated())for(f=Object.keys(this.fieldVectors),k=0;k<f.length;k++)a=f[k],c=b.FieldRef.fromString(a),d[a]=new b.MatchData;for(k=0;k<f.length;k++)c=b.FieldRef.fromString(f[k]),a=c.docRef,e.contains(a)&&!y.contains(a)&&(l=g[c.fieldName].similarity(this.fieldVectors[c]),
void 0!==(m=p[a])?(m.score+=l,m.matchData.combine(d[c])):(c={ref:a,score:l,matchData:d[c]},p[a]=c,h.push(c)));return h.sort(function(a,b){return b.score-a.score})};b.Index.prototype.toJSON=function(){var a=Object.keys(this.invertedIndex).sort().map(function(a){return[a,this.invertedIndex[a]]},this),c=Object.keys(this.fieldVectors).map(function(a){return[a,this.fieldVectors[a].toJSON()]},this);return{version:b.version,fields:this.fields,fieldVectors:c,invertedIndex:a,pipeline:this.pipeline.toJSON()}};
b.Index.load=function(a){var c={},d={},g=a.fieldVectors,e=Object.create(null),f=a.invertedIndex,h=new b.TokenSet.Builder,k=b.Pipeline.load(a.pipeline);a.version!=b.version&&b.utils.warn("Version mismatch when loading serialised index. Current version of lunr '"+b.version+"' does not match serialized index '"+a.version+"'");for(var l=0;l<g.length;l++){var m=g[l];d[m[0]]=new b.Vector(m[1])}for(l=0;l<f.length;l++)m=f[l],g=m[0],m=m[1],h.insert(g),e[g]=m;h.finish();c.fields=a.fields;c.fieldVectors=d;c.invertedIndex=
e;c.tokenSet=h.root;c.pipeline=k;return new b.Index(c)};b.Builder=function(){this._ref="id";this._fields=Object.create(null);this._documents=Object.create(null);this.invertedIndex=Object.create(null);this.fieldTermFrequencies={};this.fieldLengths={};this.tokenizer=b.tokenizer;this.pipeline=new b.Pipeline;this.searchPipeline=new b.Pipeline;this.documentCount=0;this._b=.75;this._k1=1.2;this.termIndex=0;this.metadataWhitelist=[]};b.Builder.prototype.ref=function(a){this._ref=a};b.Builder.prototype.field=
function(a,b){if(/\//.test(a))throw new RangeError("Field '"+a+"' contains illegal character '/'");this._fields[a]=b||{}};b.Builder.prototype.b=function(a){this._b=0>a?0:1<a?1:a};b.Builder.prototype.k1=function(a){this._k1=a};b.Builder.prototype.add=function(a,c){var d=a[this._ref],g=Object.keys(this._fields);this._documents[d]=c||{};this.documentCount+=1;for(var e=0;e<g.length;e++){var f=g[e],h=this._fields[f].extractor;h=h?h(a):a[f];h=this.tokenizer(h,{fields:[f]});h=this.pipeline.run(h);var k=
new b.FieldRef(d,f),l=Object.create(null);this.fieldTermFrequencies[k]=l;this.fieldLengths[k]=0;this.fieldLengths[k]+=h.length;for(k=0;k<h.length;k++){var m=h[k];void 0==l[m]&&(l[m]=0);l[m]+=1;if(void 0==this.invertedIndex[m]){var r=Object.create(null);r._index=this.termIndex;this.termIndex+=1;for(var u=0;u<g.length;u++)r[g[u]]=Object.create(null);this.invertedIndex[m]=r}void 0==this.invertedIndex[m][f][d]&&(this.invertedIndex[m][f][d]=Object.create(null));for(r=0;r<this.metadataWhitelist.length;r++){u=
this.metadataWhitelist[r];var x=m.metadata[u];void 0==this.invertedIndex[m][f][d][u]&&(this.invertedIndex[m][f][d][u]=[]);this.invertedIndex[m][f][d][u].push(x)}}}};b.Builder.prototype.calculateAverageFieldLengths=function(){for(var a=Object.keys(this.fieldLengths),c=a.length,d={},g={},e=0;e<c;e++){var f=b.FieldRef.fromString(a[e]),h=f.fieldName;g[h]||(g[h]=0);g[h]+=1;d[h]||(d[h]=0);d[h]+=this.fieldLengths[f]}a=Object.keys(this._fields);for(e=0;e<a.length;e++)c=a[e],d[c]/=g[c];this.averageFieldLength=
d};b.Builder.prototype.createFieldVectors=function(){for(var a={},c=Object.keys(this.fieldTermFrequencies),d=c.length,g=Object.create(null),e=0;e<d;e++){for(var f=b.FieldRef.fromString(c[e]),h=f.fieldName,k=this.fieldLengths[f],l=new b.Vector,m=this.fieldTermFrequencies[f],r=Object.keys(m),u=r.length,x=this._fields[h].boost||1,v=this._documents[f.docRef].boost||1,p=0;p<u;p++){var w=r[p],z=m[w],C=this.invertedIndex[w]._index;if(void 0===g[w]){var B=b.idf(this.invertedIndex[w],this.documentCount);g[w]=
B}else B=g[w];w=B*(this._k1+1)*z/(this._k1*(1-this._b+k/this.averageFieldLength[h]*this._b)+z);w*=x;w*=v;l.insert(C,Math.round(1E3*w)/1E3)}a[f]=l}this.fieldVectors=a};b.Builder.prototype.createTokenSet=function(){this.tokenSet=b.TokenSet.fromArray(Object.keys(this.invertedIndex).sort())};b.Builder.prototype.build=function(){this.calculateAverageFieldLengths();this.createFieldVectors();this.createTokenSet();return new b.Index({invertedIndex:this.invertedIndex,fieldVectors:this.fieldVectors,tokenSet:this.tokenSet,
fields:Object.keys(this._fields),pipeline:this.searchPipeline})};b.Builder.prototype.use=function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift(this);a.apply(this,b)};b.MatchData=function(a,b,d){for(var c=Object.create(null),e=Object.keys(d||{}),f=0;f<e.length;f++){var h=e[f];c[h]=d[h].slice()}this.metadata=Object.create(null);void 0!==a&&(this.metadata[a]=Object.create(null),this.metadata[a][b]=c)};b.MatchData.prototype.combine=function(a){for(var b=Object.keys(a.metadata),d=0;d<b.length;d++){var g=
b[d],e=Object.keys(a.metadata[g]);void 0==this.metadata[g]&&(this.metadata[g]=Object.create(null));for(var f=0;f<e.length;f++){var h=e[f],k=Object.keys(a.metadata[g][h]);void 0==this.metadata[g][h]&&(this.metadata[g][h]=Object.create(null));for(var l=0;l<k.length;l++){var m=k[l];this.metadata[g][h][m]=void 0==this.metadata[g][h][m]?a.metadata[g][h][m]:this.metadata[g][h][m].concat(a.metadata[g][h][m])}}}};b.MatchData.prototype.add=function(a,b,d){if(a in this.metadata)if(b in this.metadata[a])for(var c=
Object.keys(d),e=0;e<c.length;e++){var f=c[e];this.metadata[a][b][f]=f in this.metadata[a][b]?this.metadata[a][b][f].concat(d[f]):d[f]}else this.metadata[a][b]=d;else this.metadata[a]=Object.create(null),this.metadata[a][b]=d};b.Query=function(a){this.clauses=[];this.allFields=a};b.Query.wildcard=new String("*");b.Query.wildcard.NONE=0;b.Query.wildcard.LEADING=1;b.Query.wildcard.TRAILING=2;b.Query.presence={OPTIONAL:1,REQUIRED:2,PROHIBITED:3};b.Query.prototype.clause=function(a){"fields"in a||(a.fields=
this.allFields);"boost"in a||(a.boost=1);"usePipeline"in a||(a.usePipeline=!0);"wildcard"in a||(a.wildcard=b.Query.wildcard.NONE);a.wildcard&b.Query.wildcard.LEADING&&a.term.charAt(0)!=b.Query.wildcard&&(a.term="*"+a.term);a.wildcard&b.Query.wildcard.TRAILING&&a.term.slice(-1)!=b.Query.wildcard&&(a.term=""+a.term+"*");"presence"in a||(a.presence=b.Query.presence.OPTIONAL);this.clauses.push(a);return this};b.Query.prototype.isNegated=function(){for(var a=0;a<this.clauses.length;a++)if(this.clauses[a].presence!=
b.Query.presence.PROHIBITED)return!1;return!0};b.Query.prototype.term=function(a,c){if(Array.isArray(a))return a.forEach(function(a){this.term(a,b.utils.clone(c))},this),this;var d=c||{};d.term=a.toString();this.clause(d);return this};b.QueryParseError=function(a,b,d){this.name="QueryParseError";this.message=a;this.start=b;this.end=d};b.QueryParseError.prototype=Error();b.QueryLexer=function(a){this.lexemes=[];this.str=a;this.length=a.length;this.start=this.pos=0;this.escapeCharPositions=[]};b.QueryLexer.prototype.run=
function(){for(var a=b.QueryLexer.lexText;a;)a=a(this)};b.QueryLexer.prototype.sliceString=function(){for(var a=[],b=this.start,d,g=0;g<this.escapeCharPositions.length;g++)d=this.escapeCharPositions[g],a.push(this.str.slice(b,d)),b=d+1;a.push(this.str.slice(b,this.pos));this.escapeCharPositions.length=0;return a.join("")};b.QueryLexer.prototype.emit=function(a){this.lexemes.push({type:a,str:this.sliceString(),start:this.start,end:this.pos});this.start=this.pos};b.QueryLexer.prototype.escapeCharacter=
function(){this.escapeCharPositions.push(this.pos-1);this.pos+=1};b.QueryLexer.prototype.next=function(){if(this.pos>=this.length)return b.QueryLexer.EOS;var a=this.str.charAt(this.pos);this.pos+=1;return a};b.QueryLexer.prototype.width=function(){return this.pos-this.start};b.QueryLexer.prototype.ignore=function(){this.start==this.pos&&(this.pos+=1);this.start=this.pos};b.QueryLexer.prototype.backup=function(){--this.pos};b.QueryLexer.prototype.acceptDigitRun=function(){do{var a=this.next();var c=
a.charCodeAt(0)}while(47<c&&58>c);a!=b.QueryLexer.EOS&&this.backup()};b.QueryLexer.prototype.more=function(){return this.pos<this.length};b.QueryLexer.EOS="EOS";b.QueryLexer.FIELD="FIELD";b.QueryLexer.TERM="TERM";b.QueryLexer.EDIT_DISTANCE="EDIT_DISTANCE";b.QueryLexer.BOOST="BOOST";b.QueryLexer.PRESENCE="PRESENCE";b.QueryLexer.lexField=function(a){a.backup();a.emit(b.QueryLexer.FIELD);a.ignore();return b.QueryLexer.lexText};b.QueryLexer.lexTerm=function(a){1<a.width()&&(a.backup(),a.emit(b.QueryLexer.TERM));
a.ignore();if(a.more())return b.QueryLexer.lexText};b.QueryLexer.lexEditDistance=function(a){a.ignore();a.acceptDigitRun();a.emit(b.QueryLexer.EDIT_DISTANCE);return b.QueryLexer.lexText};b.QueryLexer.lexBoost=function(a){a.ignore();a.acceptDigitRun();a.emit(b.QueryLexer.BOOST);return b.QueryLexer.lexText};b.QueryLexer.lexEOS=function(a){0<a.width()&&a.emit(b.QueryLexer.TERM)};b.QueryLexer.termSeparator=b.tokenizer.separator;b.QueryLexer.lexText=function(a){for(;;){var c=a.next();if(c==b.QueryLexer.EOS)return b.QueryLexer.lexEOS;
if(92==c.charCodeAt(0))a.escapeCharacter();else{if(":"==c)return b.QueryLexer.lexField;if("~"==c)return a.backup(),0<a.width()&&a.emit(b.QueryLexer.TERM),b.QueryLexer.lexEditDistance;if("^"==c)return a.backup(),0<a.width()&&a.emit(b.QueryLexer.TERM),b.QueryLexer.lexBoost;if("+"==c&&1===a.width()||"-"==c&&1===a.width())return a.emit(b.QueryLexer.PRESENCE),b.QueryLexer.lexText;if(c.match(b.QueryLexer.termSeparator))return b.QueryLexer.lexTerm}}};b.QueryParser=function(a,c){this.lexer=new b.QueryLexer(a);
this.query=c;this.currentClause={};this.lexemeIdx=0};b.QueryParser.prototype.parse=function(){this.lexer.run();this.lexemes=this.lexer.lexemes;for(var a=b.QueryParser.parseClause;a;)a=a(this);return this.query};b.QueryParser.prototype.peekLexeme=function(){return this.lexemes[this.lexemeIdx]};b.QueryParser.prototype.consumeLexeme=function(){var a=this.peekLexeme();this.lexemeIdx+=1;return a};b.QueryParser.prototype.nextClause=function(){this.query.clause(this.currentClause);this.currentClause={}};
b.QueryParser.parseClause=function(a){a=a.peekLexeme();if(void 0!=a)switch(a.type){case b.QueryLexer.PRESENCE:return b.QueryParser.parsePresence;case b.QueryLexer.FIELD:return b.QueryParser.parseField;case b.QueryLexer.TERM:return b.QueryParser.parseTerm;default:var c="expected either a field or a term, found "+a.type;1<=a.str.length&&(c+=" with value '"+a.str+"'");throw new b.QueryParseError(c,a.start,a.end);}};b.QueryParser.parsePresence=function(a){var c=a.consumeLexeme();if(void 0!=c){switch(c.str){case "-":a.currentClause.presence=
b.Query.presence.PROHIBITED;break;case "+":a.currentClause.presence=b.Query.presence.REQUIRED;break;default:throw a="unrecognised presence operator'"+c.str+"'",new b.QueryParseError(a,c.start,c.end);}var d=a.peekLexeme();if(void 0==d)throw new b.QueryParseError("expecting term or field, found nothing",c.start,c.end);switch(d.type){case b.QueryLexer.FIELD:return b.QueryParser.parseField;case b.QueryLexer.TERM:return b.QueryParser.parseTerm;default:throw a="expecting term or field, found '"+d.type+
"'",new b.QueryParseError(a,d.start,d.end);}}};b.QueryParser.parseField=function(a){var c=a.consumeLexeme();if(void 0!=c){if(-1==a.query.allFields.indexOf(c.str))throw a=a.query.allFields.map(function(a){return"'"+a+"'"}).join(", "),a="unrecognised field '"+c.str+"', possible fields: "+a,new b.QueryParseError(a,c.start,c.end);a.currentClause.fields=[c.str];var d=a.peekLexeme();if(void 0==d)throw new b.QueryParseError("expecting term, found nothing",c.start,c.end);switch(d.type){case b.QueryLexer.TERM:return b.QueryParser.parseTerm;
default:throw a="expecting term, found '"+d.type+"'",new b.QueryParseError(a,d.start,d.end);}}};b.QueryParser.parseTerm=function(a){var c=a.consumeLexeme();if(void 0!=c)if(a.currentClause.term=c.str.toLowerCase(),-1!=c.str.indexOf("*")&&(a.currentClause.usePipeline=!1),c=a.peekLexeme(),void 0==c)a.nextClause();else switch(c.type){case b.QueryLexer.TERM:return a.nextClause(),b.QueryParser.parseTerm;case b.QueryLexer.FIELD:return a.nextClause(),b.QueryParser.parseField;case b.QueryLexer.EDIT_DISTANCE:return b.QueryParser.parseEditDistance;
case b.QueryLexer.BOOST:return b.QueryParser.parseBoost;case b.QueryLexer.PRESENCE:return a.nextClause(),b.QueryParser.parsePresence;default:throw new b.QueryParseError("Unexpected lexeme type '"+c.type+"'",c.start,c.end);}};b.QueryParser.parseEditDistance=function(a){var c=a.consumeLexeme();if(void 0!=c){var d=parseInt(c.str,10);if(isNaN(d))throw new b.QueryParseError("edit distance must be numeric",c.start,c.end);a.currentClause.editDistance=d;c=a.peekLexeme();if(void 0==c)a.nextClause();else switch(c.type){case b.QueryLexer.TERM:return a.nextClause(),
b.QueryParser.parseTerm;case b.QueryLexer.FIELD:return a.nextClause(),b.QueryParser.parseField;case b.QueryLexer.EDIT_DISTANCE:return b.QueryParser.parseEditDistance;case b.QueryLexer.BOOST:return b.QueryParser.parseBoost;case b.QueryLexer.PRESENCE:return a.nextClause(),b.QueryParser.parsePresence;default:throw a="Unexpected lexeme type '"+c.type+"'",new b.QueryParseError(a,c.start,c.end);}}};b.QueryParser.parseBoost=function(a){var c=a.consumeLexeme();if(void 0!=c){var d=parseInt(c.str,10);if(isNaN(d))throw new b.QueryParseError("boost must be numeric",
c.start,c.end);a.currentClause.boost=d;c=a.peekLexeme();if(void 0==c)a.nextClause();else switch(c.type){case b.QueryLexer.TERM:return a.nextClause(),b.QueryParser.parseTerm;case b.QueryLexer.FIELD:return a.nextClause(),b.QueryParser.parseField;case b.QueryLexer.EDIT_DISTANCE:return b.QueryParser.parseEditDistance;case b.QueryLexer.BOOST:return b.QueryParser.parseBoost;case b.QueryLexer.PRESENCE:return a.nextClause(),b.QueryParser.parsePresence;default:throw a="Unexpected lexeme type '"+c.type+"'",
new b.QueryParseError(a,c.start,c.end);}}};(function(a,b){"function"===typeof define&&define.amd?define(b):"object"===typeof exports?module.exports=b():a.lunr=b()})(this,function(){return b})})();